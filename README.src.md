# QUADRATIC SPLINE

OTAKE Takayoshi, 2019-02-02

## Condition

2次元の $n+1$ 個の点の列:

$$
P = (p_i)_{i=0}^n \tag{1.1}
$$

のスプライン曲線を求める。

ここで、各点 $p_i$ を $(x_i, y_i)$ として $x_{i} < x_{i+1}$ と $n > 0$ を条件とする。

点が $n+1$ 個あるため、スプライン曲線は $n$ 個の区間曲線の列:

$$
Spline = (S_i)_{i=0}^{n-1} \tag{1.2}
$$

となるが、この区間曲線を2次数関数:

$$
S_i(x) = a_i (x - x_i)^2 + b_i (x - x_i) + c_i \tag{1.3}
$$

とする。


## Solution

区間曲線は区間の端の点を通るため

$$
S_i(x_i) = c_i = y_i \tag{2.1}
$$

である。また、隣接する区間曲線は同一の点を通るため

$$
S_i(x_{i+1}) = S_{i+1}(x_{i+1})
$$

$$
a_i (x_{i+1} - x_i)^2 + b_i (x_{i+1} - x_i) + y_i = y_{i+1} \tag{2.2}
$$

である。

隣接する区間曲線は滑らかに連続するため、区間曲線の傾き:

$$
S_i'(x) = 2 a_i (x - x_i) + b_i
$$

は区間曲線の隣接点で等しいため

$$
S_i'(x_{i+1}) = S_{i+1}'(x_{i+1})
$$

$$
2 a_i (x_{i+1} - x_i) + b_i = b_{i+1} \tag{2.3}
$$

である。

eq. $(2.2)$ より

$$
b_i = \dfrac{ y_{i+1} - y_i }{ x_{i+1} - x_i } - a_i (x_{i+1} - x_i) \tag{2.2'}
$$

を eq. $(2.3)$ に代入して

$$
2 a_i (x_{i+1} - x_i) + \dfrac{ y_{i+1} - y_i }{ x_{i+1} - x_i } - a_i (x_{i+1} - x_i)
\\
= \dfrac{ y_{i+2} - y_{i+1} }{ x_{i+2} - x_{i+1} } - a_{i+1} (x_{i+2} - x_{i+1})
$$

$$
a_{i+1} = - \dfrac{ x_{i+1} - x_i }{ x_{i+2} - x_{i+1} } a_i + \dfrac{ \dfrac{ y_{i+2} - y_{i+1} }{ x_{i+2} - x_{i+1} } - \dfrac{ y_{i+1} - y_i }{ x_{i+1} - x_i } }{ x_{i+2} - x_{i+1} } = u_i a_i + v_i \tag{2.4}
$$

となる。ここで

$$
u_i = - \dfrac{ x_{i+1} - x_i }{ x_{i+2} - x_{i+1} }
$$

$$
v_i = \dfrac{ \dfrac{ y_{i+2} - y_{i+1} }{ x_{i+2} - x_{i+1} } - \dfrac{ y_{i+1} - y_i }{ x_{i+1} - x_i } }{ x_{i+2} - x_{i+1} }
$$

としたが、これらは既知である。

さて、eq. $(4)$ より $c_i$ が求まっていて、eq. $(2.2')$ より $b_i$ は $a_i$ で求まることがわかっている。また、eq. $(2.4)$ より $a_i$ は $a_0$ に依存することがわかっているため、$a_0$ が決まればスプライン曲線が得られる。

---

ここで $a_0 = 0$ としてスプライン曲線を得ることもできるが、$P$ にとってより滑らかなスプライン曲線を求めたい。

区間曲線の曲がり具合は

$$
S_i''(x) = 2 a_i \tag{3.1}
$$

より

$$
C_i = a_i^2 \tag{3.3}
$$

と表せるため、スプライン曲線全体の曲がり具合を

$$
C_S = \sum_{i=0}^{n-1} C_i \tag{3.4}
$$

で評価できる。

区間曲線の曲がり具合 $C_i$ は eq. $(2.4)$ より

$$
a_i^2 = (u_{i-1} a_{i-1} + v_{i-1})^2 = u_{i-1}^2 a_{i-1}^2 + 2 u_{i-1} v_{i-1} a_{i-1} + v_{i-1}^2 = \cdots
$$

と $a_i$ を $a_{i-1}$ で代入する事を繰り返すと $a_0$ の2次関数となるため、eq. $(3.4)$ も $a_0$ の2次数関数となる。

ここで

$$
U_j a_j^2 + V_j a_j + W_j \Rightarrow U_{j-1} a_{j-1}^2 + V_{j-1} a_{j-1} + W_{j-1} \Rightarrow \cdots
$$

と変換を繰り返すイメージで

$$
u_j^2 a_j^2 + 2 u_j v_j a_j + v_j^2 = U_j a_j^2 + V_j a_j + W_j = U_j (u_{j-1} a_{j-1} + v_{j-1})^2 + V_j (u_{j-1} a_{j-1} + v_{j-1}) + W_j
\\
= U_j u_{j-1}^2 a_{j-1}^2 + (2 U_j u_{j-1} v_{j-1} + V_j u_{j-1}) a_{j-1} + (U_j v_{j-1}^2 + V_j v_{j-1} + W_j)
\\
= U_{j-1} a_{j-1}^2 + V_{j-1} a_{j-1} + W_{j-1}
$$

のため

$$
U_{j-1} = U_j (u_{j-1}^2)
\\
V_{j-1} = U_j (2 u_{j-1} v_{j-1}) + V_j (u_{j-1})
\\
W_{j-1} = U_j (v_{j-1}^2) + V_j (v_{j-1}) + W_j
$$

となる。ここで $U_j = 1, V_j = 0, W_j = 0$ である。ここで $j$ を添字としたのは、この計算が $\sum_{i=0}^{n-1} C_i$ の各 $C_i$ の算出のために繰り返されるためである。


さて eq. $(3.4)$ は

$$
U_C a_o^2 + V_C a_0 + W_C \tag{3.5}
$$

のようになるが

$$
C_S''(a_0) = 2 U_C > 0 \quad (\because u_i^2 > 0) \tag{3.6}
$$

であるため

$$
C_S'(a_0) = 2 U_C a_0 + V_C = 0 \tag{3.7}
$$

を満たす

$$
a_0 = - \dfrac{ V_C }{ 2 U_C } \tag{3.8}
$$

が最良となる。


NOTE: 導出過程で $b_i$ から $a_i$ を求めることも可能であるが、適当な $b_0$ を決定することができないため、$a_i$ から $b_i$ を算出する。
